<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>TryHackMe - Agent Sudo Writeup - SHAFIQAIMAN</title><meta name="Description" content="shafiqaiman.com is a cybersecurity/ethical hacking website that focus on publishing of writeup in HacktheBox, Tryhackme and other online CTF (capture the flag) challenge."><meta property="og:title" content="TryHackMe - Agent Sudo Writeup" />
<meta property="og:description" content="Link : https://tryhackme.com/room/agentsudoctf
Enumeration First, let’s do an enumeration with the IP address of this machine. I’m gonna run Nmap [Netwok Mapper] to scan any open ports. I’m gonna run this command
1 nmap -sC -sV -oN nmap/initial &lt;machine ip&gt; Explaining the nmap scan: -sC	:= scan using nmap default script -sV	:= scan for version -oN := output in normal format 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Nmap 7." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/thm/agent_sudo/" /><meta property="og:image" content="http://localhost:1313/posts/thm/agent_sudo/featured.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-07-10T00:00:00+00:00" /><meta property="og:site_name" content="SHAFIQAIMAN" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/posts/thm/agent_sudo/featured.png" /><meta name="twitter:title" content="TryHackMe - Agent Sudo Writeup"/>
<meta name="twitter:description" content="Link : https://tryhackme.com/room/agentsudoctf
Enumeration First, let’s do an enumeration with the IP address of this machine. I’m gonna run Nmap [Netwok Mapper] to scan any open ports. I’m gonna run this command
1 nmap -sC -sV -oN nmap/initial &lt;machine ip&gt; Explaining the nmap scan: -sC	:= scan using nmap default script -sV	:= scan for version -oN := output in normal format 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Nmap 7."/>
<meta name="twitter:site" content="@_shafiqaiman_"/>
<meta name="application-name" content="SHAFIQAIMAN">
<meta name="apple-mobile-web-app-title" content="SHAFIQAIMAN"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/posts/thm/agent_sudo/" /><link rel="prev" href="http://localhost:1313/posts/thm/anonforce/" /><link rel="next" href="http://localhost:1313/posts/htb/oopsie/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "TryHackMe - Agent Sudo Writeup",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/posts\/thm\/agent_sudo\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "http:\/\/localhost:1313\/posts\/thm\/agent_sudo\/featured.png",
                            "width":  499 ,
                            "height":  117 
                        }],"genre": "posts","keywords": "stegseek, CVE-2019-14287, ftp, python","wordcount":  1172 ,
        "url": "http:\/\/localhost:1313\/posts\/thm\/agent_sudo\/","datePublished": "2021-07-10T00:00:00+00:00","dateModified": "2021-07-10T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "SH∆FIQ ∆IM∆N"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="SHAFIQAIMAN">SH∆FIQ∆IM∆N</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/" title="Posts"><i class="fa-solid fa-book"></i>  </a><a class="menu-item" href="/tags/" title="Tags"><i class="fa-solid fa-tags"></i>  </a><a class="menu-item" href="/categories/" title="Categories"><i class="fa-solid fa-folder"></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="SHAFIQAIMAN">SH∆FIQ∆IM∆N</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="Posts"><i class="fa-solid fa-book"></i></a><a class="menu-item" href="/tags/" title="Tags"><i class="fa-solid fa-tags"></i></a><a class="menu-item" href="/categories/" title="Categories"><i class="fa-solid fa-folder"></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">TryHackMe - Agent Sudo Writeup</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://shafiqaiman.com" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>SH∆FIQ ∆IM∆N</a></span>&nbsp;<span class="post-category">included in <a href="/categories/tryhackme/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>TryHackMe</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="10-07-2021">10-07-2021</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1172 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/featured.png"
        data-srcset="/posts/thm/agent_sudo/featured.png, /posts/thm/agent_sudo/featured.png 1.5x, /posts/thm/agent_sudo/featured.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/featured.png"
        title="/posts/thm/agent_sudo/featured.png" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#enumeration">Enumeration</a>
      <ul>
        <li><a href="#explaining-the-nmap-scan">Explaining the nmap scan:</a></li>
        <li><a href="#python-script">Python Script</a></li>
      </ul>
    </li>
    <li><a href="#footholdgaining-access">Foothold/Gaining Access</a></li>
    <li><a href="#privilege-escalation">Privilege Escalation</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><a href="https://tryhackme.com/room/agentsudoctf" target="_blank" rel="noopener noreffer ">Link : https://tryhackme.com/room/agentsudoctf</a></p>
<h2 id="enumeration">Enumeration</h2>
<p>First, let’s do an enumeration with the IP address of this machine. I’m gonna run Nmap [Netwok Mapper] to scan any open ports. I’m gonna run this command</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nmap -sC -sV -oN nmap/initial &lt;machine ip&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="explaining-the-nmap-scan">Explaining the nmap scan:</h3>
<ul>
<li>-sC	:= scan using nmap default script</li>
<li>-sV	:= scan for version</li>
<li>-oN := output in normal format</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">Nmap</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">91</span><span class="w"> </span><span class="n">scan</span><span class="w"> </span><span class="n">initiated</span><span class="w"> </span><span class="n">Fri</span><span class="w"> </span><span class="n">May</span><span class="w">  </span><span class="mi">7</span><span class="w"> </span><span class="mi">17</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">26</span><span class="w"> </span><span class="mi">2021</span><span class="w"> </span><span class="k">as</span><span class="p">:</span><span class="w"> </span><span class="n">nmap</span><span class="w"> </span><span class="o">-</span><span class="n">sC</span><span class="w"> </span><span class="o">-</span><span class="n">sV</span><span class="w"> </span><span class="o">-</span><span class="k">oN</span><span class="w"> </span><span class="n">nmap</span><span class="o">/</span><span class="n">initial</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">240</span><span class="p">.</span><span class="mi">194</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Nmap</span><span class="w"> </span><span class="n">scan</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">240</span><span class="p">.</span><span class="mi">194</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">Host</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">67</span><span class="n">s</span><span class="w"> </span><span class="n">latency</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">Not</span><span class="w"> </span><span class="n">shown</span><span class="p">:</span><span class="w"> </span><span class="mi">997</span><span class="w"> </span><span class="n">closed</span><span class="w"> </span><span class="n">ports</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">PORT</span><span class="w">   </span><span class="k">STATE</span><span class="w"> </span><span class="n">SERVICE</span><span class="w"> </span><span class="k">VERSION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">21</span><span class="o">/</span><span class="n">tcp</span><span class="w"> </span><span class="k">open</span><span class="w">  </span><span class="n">ftp</span><span class="w">     </span><span class="n">vsftpd</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">22</span><span class="o">/</span><span class="n">tcp</span><span class="w"> </span><span class="k">open</span><span class="w">  </span><span class="n">ssh</span><span class="w">     </span><span class="n">OpenSSH</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">6</span><span class="n">p1</span><span class="w"> </span><span class="n">Ubuntu</span><span class="w"> </span><span class="mi">4</span><span class="n">ubuntu0</span><span class="p">.</span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">Ubuntu</span><span class="w"> </span><span class="n">Linux</span><span class="p">;</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">ssh</span><span class="o">-</span><span class="n">hostkey</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">   </span><span class="mi">2048</span><span class="w"> </span><span class="n">ef</span><span class="p">:</span><span class="mi">1</span><span class="n">f</span><span class="p">:</span><span class="mi">5</span><span class="n">d</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="n">d4</span><span class="p">:</span><span class="mi">77</span><span class="p">:</span><span class="mi">95</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">60</span><span class="p">:</span><span class="mi">72</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">f0</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="n">f2</span><span class="p">:</span><span class="n">cc</span><span class="p">:</span><span class="mi">07</span><span class="w"> </span><span class="p">(</span><span class="n">RSA</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">   </span><span class="mi">256</span><span class="w"> </span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="n">d1</span><span class="p">:</span><span class="mi">9</span><span class="n">a</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="n">e7</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">62</span><span class="p">:</span><span class="n">c1</span><span class="p">:</span><span class="mi">9</span><span class="n">e</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">84</span><span class="p">:</span><span class="mi">8</span><span class="n">a</span><span class="p">:</span><span class="n">e7</span><span class="p">:</span><span class="n">ea</span><span class="w"> </span><span class="p">(</span><span class="n">ECDSA</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="n">_</span><span class="w">  </span><span class="mi">256</span><span class="w"> </span><span class="mi">2</span><span class="n">d</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">5</span><span class="k">c</span><span class="p">:</span><span class="n">b9</span><span class="p">:</span><span class="n">fd</span><span class="p">:</span><span class="n">a8</span><span class="p">:</span><span class="n">c8</span><span class="p">:</span><span class="n">d8</span><span class="p">:</span><span class="mi">80</span><span class="p">:</span><span class="n">e3</span><span class="p">:</span><span class="mi">92</span><span class="p">:</span><span class="mi">4</span><span class="n">f</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">4</span><span class="n">f</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="n">e2</span><span class="w"> </span><span class="p">(</span><span class="n">ED25519</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">80</span><span class="o">/</span><span class="n">tcp</span><span class="w"> </span><span class="k">open</span><span class="w">  </span><span class="n">http</span><span class="w">    </span><span class="n">Apache</span><span class="w"> </span><span class="n">httpd</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">29</span><span class="w"> </span><span class="p">((</span><span class="n">Ubuntu</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">header</span><span class="p">:</span><span class="w"> </span><span class="n">Apache</span><span class="o">/</span><span class="mi">2</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">29</span><span class="w"> </span><span class="p">(</span><span class="n">Ubuntu</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">Annoucement</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Service</span><span class="w"> </span><span class="n">Info</span><span class="p">:</span><span class="w"> </span><span class="n">OSs</span><span class="p">:</span><span class="w"> </span><span class="n">Unix</span><span class="p">,</span><span class="w"> </span><span class="n">Linux</span><span class="p">;</span><span class="w"> </span><span class="n">CPE</span><span class="p">:</span><span class="w"> </span><span class="n">cpe</span><span class="p">:</span><span class="o">/</span><span class="n">o</span><span class="p">:</span><span class="n">linux</span><span class="p">:</span><span class="n">linux_kernelService</span><span class="w"> </span><span class="n">detection</span><span class="w"> </span><span class="n">performed</span><span class="p">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="k">any</span><span class="w"> </span><span class="n">incorrect</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nmap</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">submit</span><span class="o">/</span><span class="w"> </span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="n">Nmap</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">Fri</span><span class="w"> </span><span class="n">May</span><span class="w">  </span><span class="mi">7</span><span class="w"> </span><span class="mi">17</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">48</span><span class="w"> </span><span class="mi">2021</span><span class="w"> </span><span class="c1">-- 1 IP address (1 host up) scanned in 21.32 seconds
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The scan result shows us. There are 3 open ports. Let’s start enumerating them.</p>
<ul>
<li>21 / ftp</li>
<li>22 / ssh</li>
<li>80 / http</li>
</ul>
<p>Looks like this machine has a webpage on port 80 running on apache. Let’s take a look</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/2.png"
        data-srcset="/posts/thm/agent_sudo/2.png, /posts/thm/agent_sudo/2.png 1.5x, /posts/thm/agent_sudo/2.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/2.png"
        title="2" width="596" height="319" /></p>
<p>Hmmmmm… It’s says something about <code>user-agent</code> and I’m not find anything in the source code. <code>Codename?</code> it sounds fun yet confusing. So, like any mad man will do. I’ll try to change the user-agent into anything <code>from windows to android</code> but nothing really weird happens. Turn’s out, the <code>hint</code> sitting in front of me the entire time… ARRRRGGGG!!!</p>
<p>So, this message is from <code>agent R</code> if you look closer. Not the monitor tho. DAA!!. The agent is using the codename with the uppercase letter. I’m gonna assume this agent also use uppercase letter but which one? The alphabets contain 26 letters <code>NOTE: English alphabets have 26 letters, OK! are you happy now! jk :)</code></p>
<h3 id="python-script">Python Script</h3>
<p>python script for brute-forcing user-agent. I’m gonna brute-force with uppercase letters.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://10.10.30.160&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Finally, we got hit for letter C. Let’s gooo baby! yes. I’m excited</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  Agent_Sudo python3 brute.py                         
</span></span><span class="line"><span class="cl"><span class="m">218</span> A
</span></span><span class="line"><span class="cl"><span class="m">218</span> B
</span></span><span class="line"><span class="cl"><span class="m">177</span> C
</span></span><span class="line"><span class="cl"><span class="m">218</span> D
</span></span><span class="line"><span class="cl"><span class="m">218</span> E
</span></span><span class="line"><span class="cl"><span class="m">218</span> F
</span></span><span class="line"><span class="cl"><span class="m">218</span> G
</span></span><span class="line"><span class="cl"><span class="m">218</span> H
</span></span></code></pre></td></tr></table>
</div>
</div><p>Let’s edit our user-agent into “C”. I’m gonna use the <code>dev-tools</code> built-in function in the browser to access it <code>press f12</code> and go to <code>network</code> click <code>reload. NOTE: I’m using firefox in this case</code></p>
<p>Then, click the one on the list. <code>Right-click</code> and <code>Edit and Resend</code>, make sure to edit the user-agent into <code>“C”</code>. After, all done click <code>Send</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/3.png"
        data-srcset="/posts/thm/agent_sudo/3.png, /posts/thm/agent_sudo/3.png 1.5x, /posts/thm/agent_sudo/3.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/3.png"
        title="3" width="700" height="220" /></p>
<p>After, you click send. We’ve found something new in there. Something like this</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/4.png"
        data-srcset="/posts/thm/agent_sudo/4.png, /posts/thm/agent_sudo/4.png 1.5x, /posts/thm/agent_sudo/4.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/4.png"
        title="4" width="700" height="228" /></p>
<p>Let’s navigate to that page. It looks like we’ve got a new message and a new user.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/5.png"
        data-srcset="/posts/thm/agent_sudo/5.png, /posts/thm/agent_sudo/5.png 1.5x, /posts/thm/agent_sudo/5.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/5.png"
        title="5" width="700" height="237" /></p>
<p>It’s says something about a weak password. So, I’m gonna assume we can brute-force ssh with that username or brute-force FTP with that username. First, let’s try with FTP.</p>
<p>Now, let’s try brute-force it using hydra.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  Agent_Sudo hydra ftp://10.10.30.160 -l <span class="s2">&#34;chris&#34;</span> -P /opt/rockyou.txt -vV
</span></span><span class="line"><span class="cl">Hydra v9.0 <span class="o">(</span>c<span class="o">)</span> <span class="m">2019</span> by van Hauser/THC - Please <span class="k">do</span> not use in military or secret service organizations, or <span class="k">for</span> illegal purposes.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hydra <span class="o">(</span>https://github.com/vanhauser-thc/thc-hydra<span class="o">)</span> starting at 2021-05-07 19:02:03
</span></span><span class="line"><span class="cl"><span class="o">[</span>DATA<span class="o">]</span> max <span class="m">16</span> tasks per <span class="m">1</span> server, overall <span class="m">16</span> tasks, <span class="m">14344401</span> login tries <span class="o">(</span>l:1/p:14344401<span class="o">)</span>, ~896526 tries per task
</span></span><span class="line"><span class="cl"><span class="o">[</span>DATA<span class="o">]</span> attacking ftp://10.10.30.160:21/
</span></span><span class="line"><span class="cl"><span class="o">[</span>VERBOSE<span class="o">]</span> Resolving addresses ... <span class="o">[</span>VERBOSE<span class="o">]</span> resolving <span class="k">done</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ATTEMPT<span class="o">]</span> target 10.10.30.160 - login <span class="s2">&#34;chris&#34;</span> - pass <span class="s2">&#34;123456&#34;</span> - <span class="m">1</span> of <span class="m">14344401</span> <span class="o">[</span>child 0<span class="o">]</span> <span class="o">(</span>0/0<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---<span class="o">[</span>snip<span class="o">]</span>---
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>ATTEMPT<span class="o">]</span> target 10.10.30.160 - login <span class="s2">&#34;chris&#34;</span> - pass <span class="s2">&#34;censored&#34;</span> - <span class="m">256</span> of <span class="m">14344401</span> <span class="o">[</span>child 15<span class="o">]</span> <span class="o">(</span>0/0<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>21<span class="o">][</span>ftp<span class="o">]</span> host: 10.10.30.160   login: <span class="s2">&#34;chris&#34;</span>   password: <span class="s2">&#34;xxxxxxxx&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>STATUS<span class="o">]</span> attack finished <span class="k">for</span> 10.10.30.160 <span class="o">(</span>waiting <span class="k">for</span> children to <span class="nb">complete</span> tests<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">1</span> of <span class="m">1</span> target successfully completed, <span class="m">1</span> valid password found
</span></span></code></pre></td></tr></table>
</div>
</div><p>YES! we found the password. Now, let’s try to login in. SUCCESS. So, let’s download all the files in that into our machine using <code>the mget command</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/6.png"
        data-srcset="/posts/thm/agent_sudo/6.png, /posts/thm/agent_sudo/6.png 1.5x, /posts/thm/agent_sudo/6.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/6.png"
        title="6" width="700" height="708" /></p>
<p>We have all the files in here. Let’s take a look one by one. First, let’s start with the <code>text file</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/7.png"
        data-srcset="/posts/thm/agent_sudo/7.png, /posts/thm/agent_sudo/7.png 1.5x, /posts/thm/agent_sudo/7.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/7.png"
        title="7" width="700" height="121" /></p>
<p>That’s so interesting message and it sounds like steganography to me. Now, I’m gonna crack one of the image file using stegseek. <code>NOTE: stegseek only works on the jpg file.</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/8.png"
        data-srcset="/posts/thm/agent_sudo/8.png, /posts/thm/agent_sudo/8.png 1.5x, /posts/thm/agent_sudo/8.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/8.png"
        title="8" width="641" height="376" /></p>
<p>wow! these tools so amazing it is super fast. Anyways, we found the password. Also, we got a file. Let’s cat the content of it.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/9.png"
        data-srcset="/posts/thm/agent_sudo/9.png, /posts/thm/agent_sudo/9.png 1.5x, /posts/thm/agent_sudo/9.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/9.png"
        title="9" width="700" height="364" /></p>
<p>That’s true. So, cheesy but look at the bright side. We’ve just got a password and a new user. So, I’m gonna assume this is for ssh but before we try it.</p>
<p>I’m curious about the png file. The question wants a zip file password but still, we don’t have or found any zip file yet. So, I’m gonna <code>extract files</code> from png image using <code>cyberchef</code>. Wow, it unbelievable we found the zip file in it let’s download it.</p>
<p>This is personal to me. The first thing, I’m gonna do is change the file name. It is too longggggg. :)</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/10.png"
        data-srcset="/posts/thm/agent_sudo/10.png, /posts/thm/agent_sudo/10.png 1.5x, /posts/thm/agent_sudo/10.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/10.png"
        title="10" width="700" height="464" /></p>
<p>Unfortunately, we can’t extract the file because it’s password protected.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/11.png"
        data-srcset="/posts/thm/agent_sudo/11.png, /posts/thm/agent_sudo/11.png 1.5x, /posts/thm/agent_sudo/11.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/11.png"
        title="11" width="700" height="477" /></p>
<p>Anyways, let’s crack this zip file using john the ripper [JtR]. First, we need to convert the file to make sure [JtR] would understand it. I’m gonna use <code>zip2john</code> and then I’m using <code>John-The-Ripper</code> to crack it. Here the image of it.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/12.png"
        data-srcset="/posts/thm/agent_sudo/12.png, /posts/thm/agent_sudo/12.png 1.5x, /posts/thm/agent_sudo/12.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/12.png"
        title="12" width="700" height="223" /></p>
<p>Let’s read the file content.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/13.png"
        data-srcset="/posts/thm/agent_sudo/13.png, /posts/thm/agent_sudo/13.png 1.5x, /posts/thm/agent_sudo/13.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/13.png"
        title="13" width="682" height="263" /></p>
<p>We’ve found something encrypted. It looks like base64 and we got it. It is base64 but is this something useful?. We still don’t know yet but let’s go to the main event ssh.</p>
<h2 id="footholdgaining-access">Foothold/Gaining Access</h2>
<p>Let’s ssh with that creds and see what’s happening next. WOW! I’m in.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/14.png"
        data-srcset="/posts/thm/agent_sudo/14.png, /posts/thm/agent_sudo/14.png 1.5x, /posts/thm/agent_sudo/14.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/14.png"
        title="14" width="700" height="309" /></p>
<p>YES!, we found the user flag.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/15.png"
        data-srcset="/posts/thm/agent_sudo/15.png, /posts/thm/agent_sudo/15.png 1.5x, /posts/thm/agent_sudo/15.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/15.png"
        title="15" width="489" height="207" /></p>
<p>Also, we found another image file let’s try to download it into our machine. Using <code>scp command</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/16.png"
        data-srcset="/posts/thm/agent_sudo/16.png, /posts/thm/agent_sudo/16.png 1.5x, /posts/thm/agent_sudo/16.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/16.png"
        title="16" width="700" height="164" /></p>
<h2 id="privilege-escalation">Privilege Escalation</h2>
<p>Now, we’ve got the file on our machine. Anyways, Let’s enumerate this machine more. First, I’m gonna use the <code>sudo -l</code> command to see anything that super interesting.</p>
<p>Wow! I’ve found the interesting thing.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/17.png"
        data-srcset="/posts/thm/agent_sudo/17.png, /posts/thm/agent_sudo/17.png 1.5x, /posts/thm/agent_sudo/17.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/17.png"
        title="17" width="700" height="163" /></p>
<p>I have seen this before but I forgot what the cve of this sudo. I’ll try google it and found it. CVE-2019–14287 . Let’s become root. MUAHAHAHAHAH</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/thm/agent_sudo/18.png"
        data-srcset="/posts/thm/agent_sudo/18.png, /posts/thm/agent_sudo/18.png 1.5x, /posts/thm/agent_sudo/18.png 2x"
        data-sizes="auto"
        alt="/posts/thm/agent_sudo/18.png"
        title="18" width="700" height="307" /></p>
<p>We’ve found the final flag and we’ve become root.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I’ve learned a lot today. First, do not make your password too short or too simple and the important thing make sure don’t put any sensitive data on public and non-secure platforms. Always, update your system. We can see in this room we become root using the CVE. Please update your system.</p>
<p>This room so much fun and I hope you guys have fun and learn something new today.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 10-07-2021</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://localhost:1313/posts/thm/agent_sudo/" data-title="TryHackMe - Agent Sudo Writeup" data-via="_shafiqaiman_" data-hashtags="stegseek,CVE-2019-14287,ftp,python"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/posts/thm/agent_sudo/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/posts/thm/agent_sudo/" data-title="TryHackMe - Agent Sudo Writeup"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="http://localhost:1313/posts/thm/agent_sudo/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/stegseek/">Stegseek</a>,&nbsp;<a href="/tags/cve-2019-14287/">CVE-2019-14287</a>,&nbsp;<a href="/tags/ftp/">Ftp</a>,&nbsp;<a href="/tags/python/">Python</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/thm/anonforce/" class="prev" rel="prev" title="TryHackMe - Anonforce Writeup"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>TryHackMe - Anonforce Writeup</a>
            <a href="/posts/htb/oopsie/" class="next" rel="next" title="HackTheBox - Oopsie Writeup">HackTheBox - Oopsie Writeup<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2021 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://shafiqaiman.com" target="_blank">SHAFIQAIMAN</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
