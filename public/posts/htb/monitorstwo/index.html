<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>HackTheBox - MonitorsTwo Writeup - SHAFIQAIMAN</title><meta name="Description" content="shafiqaiman.com is a cybersecurity/ethical hacking website that focus on publishing of writeup in HacktheBox, Tryhackme and other online CTF (capture the flag) challenge."><meta property="og:title" content="HackTheBox - MonitorsTwo Writeup" />
<meta property="og:description" content="Nmap Like always, I’m going to scan the IP Address by using nmap but I’m going to scan the full port first. Then, I’m going to scan the only open ports.
1 2 3 4 5 6 7 8 9 10 11 12 13 nmap -sCV -p22,80 -oN nmap/monitorstwo 10.10.11.211 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA) | 256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA) |_ 256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519) 80/tcp open http nginx 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shafiqaiman.com/posts/htb/monitorstwo/" /><meta property="og:image" content="https://shafiqaiman.com/posts/htb/monitorstwo/featured.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-09-03T00:00:00+00:00" /><meta property="og:site_name" content="SHAFIQAIMAN" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://shafiqaiman.com/posts/htb/monitorstwo/featured.png"/>
<meta name="twitter:title" content="HackTheBox - MonitorsTwo Writeup"/>
<meta name="twitter:description" content="Nmap Like always, I’m going to scan the IP Address by using nmap but I’m going to scan the full port first. Then, I’m going to scan the only open ports.
1 2 3 4 5 6 7 8 9 10 11 12 13 nmap -sCV -p22,80 -oN nmap/monitorstwo 10.10.11.211 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA) | 256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA) |_ 256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519) 80/tcp open http nginx 1."/>
<meta name="application-name" content="SHAFIQAIMAN">
<meta name="apple-mobile-web-app-title" content="SHAFIQAIMAN"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://shafiqaiman.com/posts/htb/monitorstwo/" /><link rel="prev" href="https://shafiqaiman.com/posts/htb/busqueda/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "HackTheBox - MonitorsTwo Writeup",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/shafiqaiman.com\/posts\/htb\/monitorstwo\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/shafiqaiman.com\/posts\/htb\/monitorstwo\/featured.png",
                            "width":  1400 ,
                            "height":  1060 
                        }],"genre": "posts","keywords": "CVE-2022-46169, CVE-2021-41091, upgrade-shell-using-script, rce, GTFOBins, capsh, mysql, john, docker","wordcount":  784 ,
        "url": "https:\/\/shafiqaiman.com\/posts\/htb\/monitorstwo\/","datePublished": "2023-09-03T00:00:00+00:00","dateModified": "2023-09-03T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "SH∆FIQ ∆IM∆N"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="SHAFIQAIMAN">SH∆FIQ∆IM∆N</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/" title="Posts"><i class="fa-solid fa-book"></i>  </a><a class="menu-item" href="/tags/" title="Tags"><i class="fa-solid fa-tags"></i>  </a><a class="menu-item" href="/categories/" title="Categories"><i class="fa-solid fa-folder"></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="SHAFIQAIMAN">SH∆FIQ∆IM∆N</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="Posts"><i class="fa-solid fa-book"></i></a><a class="menu-item" href="/tags/" title="Tags"><i class="fa-solid fa-tags"></i></a><a class="menu-item" href="/categories/" title="Categories"><i class="fa-solid fa-folder"></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">HackTheBox - MonitorsTwo Writeup</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://shafiqaiman.com" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>SH∆FIQ ∆IM∆N</a></span>&nbsp;<span class="post-category">included in <a href="/categories/hackthebox/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>HacktheBox</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="03-09-2023">03-09-2023</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;784 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;4 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/htb/monitorstwo/featured.png"
        data-srcset="/posts/htb/monitorstwo/featured.png, /posts/htb/monitorstwo/featured.png 1.5x, /posts/htb/monitorstwo/featured.png 2x"
        data-sizes="auto"
        alt="/posts/htb/monitorstwo/featured.png"
        title="/posts/htb/monitorstwo/featured.png" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#nmap">Nmap</a></li>
    <li><a href="#http-cacti-login">Http: Cacti Login</a></li>
    <li><a href="#docker-foothold---cve-2022-46169">Docker: foothold - CVE-2022-46169</a>
      <ul>
        <li><a href="#docker-privesc---capsh">Docker: privesc - capsh</a></li>
        <li><a href="#docker-entrypointsh">Docker: entrypoint.sh</a></li>
        <li><a href="#docker-mysql">Docker: mysql</a></li>
      </ul>
    </li>
    <li><a href="#ssh-marcus">SSH: marcus</a>
      <ul>
        <li><a href="#ssh-docker-version">SSH: docker version</a></li>
      </ul>
    </li>
    <li><a href="#privesc-cve-2021-41091">PrivEsc: CVE-2021-41091</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="nmap">Nmap</h2>
<p>Like always, I’m going to scan the IP Address by using <a href="https://nmap.org/" target="_blank" rel="noopener noreffer ">nmap</a> but I’m going to scan the full port first. Then, I’m going to scan the only open ports.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">nmap</span><span class="w"> </span><span class="o">-</span><span class="n">sCV</span><span class="w"> </span><span class="o">-</span><span class="n">p22</span><span class="p">,</span><span class="mi">80</span><span class="w"> </span><span class="o">-</span><span class="k">oN</span><span class="w"> </span><span class="n">nmap</span><span class="o">/</span><span class="n">monitorstwo</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">11</span><span class="p">.</span><span class="mi">211</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">PORT</span><span class="w">   </span><span class="k">STATE</span><span class="w"> </span><span class="n">SERVICE</span><span class="w"> </span><span class="k">VERSION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">22</span><span class="o">/</span><span class="n">tcp</span><span class="w"> </span><span class="k">open</span><span class="w">  </span><span class="n">ssh</span><span class="w">     </span><span class="n">OpenSSH</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">2</span><span class="n">p1</span><span class="w"> </span><span class="n">Ubuntu</span><span class="w"> </span><span class="mi">4</span><span class="n">ubuntu0</span><span class="p">.</span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="n">Ubuntu</span><span class="w"> </span><span class="n">Linux</span><span class="p">;</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">ssh</span><span class="o">-</span><span class="n">hostkey</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">   </span><span class="mi">3072</span><span class="w"> </span><span class="mi">48</span><span class="p">:</span><span class="n">ad</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">b8</span><span class="p">:</span><span class="mi">3</span><span class="n">a</span><span class="p">:</span><span class="mi">9</span><span class="n">f</span><span class="p">:</span><span class="n">bc</span><span class="p">:</span><span class="n">be</span><span class="p">:</span><span class="n">f7</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">1</span><span class="n">e</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="n">bf</span><span class="p">:</span><span class="n">de</span><span class="p">:</span><span class="n">ae</span><span class="w"> </span><span class="p">(</span><span class="n">RSA</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">   </span><span class="mi">256</span><span class="w"> </span><span class="n">b7</span><span class="p">:</span><span class="mi">89</span><span class="p">:</span><span class="mi">6</span><span class="k">c</span><span class="p">:</span><span class="mi">0</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="n">ed</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="n">b2</span><span class="p">:</span><span class="n">c1</span><span class="p">:</span><span class="mi">86</span><span class="p">:</span><span class="mi">7</span><span class="k">c</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">92</span><span class="p">:</span><span class="mi">74</span><span class="p">:</span><span class="mi">1</span><span class="k">c</span><span class="p">:</span><span class="mi">1</span><span class="n">f</span><span class="w"> </span><span class="p">(</span><span class="n">ECDSA</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="n">_</span><span class="w">  </span><span class="mi">256</span><span class="w"> </span><span class="mi">18</span><span class="p">:</span><span class="n">cd</span><span class="p">:</span><span class="mi">9</span><span class="n">d</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="n">a6</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="n">a8</span><span class="p">:</span><span class="n">b8</span><span class="p">:</span><span class="n">b6</span><span class="p">:</span><span class="n">f7</span><span class="p">:</span><span class="mi">9</span><span class="n">f</span><span class="p">:</span><span class="mi">8</span><span class="n">d</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="n">fb</span><span class="w"> </span><span class="p">(</span><span class="n">ED25519</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">80</span><span class="o">/</span><span class="n">tcp</span><span class="w"> </span><span class="k">open</span><span class="w">  </span><span class="n">http</span><span class="w">    </span><span class="n">nginx</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">18</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">Ubuntu</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">Login</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">Cacti</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">header</span><span class="p">:</span><span class="w"> </span><span class="n">nginx</span><span class="o">/</span><span class="mi">1</span><span class="p">.</span><span class="mi">18</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">Ubuntu</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Service</span><span class="w"> </span><span class="n">Info</span><span class="p">:</span><span class="w"> </span><span class="n">OS</span><span class="p">:</span><span class="w"> </span><span class="n">Linux</span><span class="p">;</span><span class="w"> </span><span class="n">CPE</span><span class="p">:</span><span class="w"> </span><span class="n">cpe</span><span class="p">:</span><span class="o">/</span><span class="n">o</span><span class="p">:</span><span class="n">linux</span><span class="p">:</span><span class="n">linux_kernel</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The nmap scan result is completed. There are just <code>two</code> port opens which are <code>SSH, HTTP</code>. Based on the <a href="https://bugs.launchpad.net/ubuntu/&#43;source/openssh/1:8.2p1-4ubuntu0.5" target="_blank" rel="noopener noreffer ">OpenSSH</a> version, the target most likely running <code>Ubuntu 20.04</code>, codename <code>Focal Fossa</code>. I&rsquo;m going to ignore <code>port 22</code> which is <code>SSH</code>, since I don&rsquo;t have any credentials.</p>
<h2 id="http-cacti-login">Http: Cacti Login</h2>
<p>So, I&rsquo;m going to navigated to <code>port 80</code> through my browser and I&rsquo;ve been greeted with <a href="http://www.cacti.net/" target="_blank" rel="noopener noreffer ">Cacti</a> login page. As usual, I&rsquo;ll tried a bunch of credentials combination such as <code>admin:admin, admin:password, root:root</code> and much more. Unfortunately, all of them were wrong.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/http-cacti-login.png" title="cacti login page" data-thumbnail="/posts/htb/monitorstwo/http-cacti-login.png" data-sub-html="<h2>cacti login page</h2><p>cacti login page</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/http-cacti-login.png"
            data-srcset="/posts/htb/monitorstwo/http-cacti-login.png, /posts/htb/monitorstwo/http-cacti-login.png 1.5x, /posts/htb/monitorstwo/http-cacti-login.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/http-cacti-login.png" width="743" height="492" />
    </a><figcaption class="image-caption">cacti login page</figcaption>
    </figure></p>
<h2 id="docker-foothold---cve-2022-46169">Docker: foothold - CVE-2022-46169</h2>
<p>Then, I realized on the login page. It&rsquo;s showing the version number of this web application, which is <code>Cacti v1.2.22</code>.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/http-cacti-login-version.png" title="cacti version" data-thumbnail="/posts/htb/monitorstwo/http-cacti-login-version.png" data-sub-html="<h2>cacti version</h2><p>cacti version</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/http-cacti-login-version.png"
            data-srcset="/posts/htb/monitorstwo/http-cacti-login-version.png, /posts/htb/monitorstwo/http-cacti-login-version.png 1.5x, /posts/htb/monitorstwo/http-cacti-login-version.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/http-cacti-login-version.png" width="317" height="69" />
    </a><figcaption class="image-caption">cacti version</figcaption>
    </figure></p>
<p>It&rsquo;s appear to be vulnerable to unauthenticated <code>RCE</code> and it gets assign as <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-46169" target="_blank" rel="noopener noreffer ">CVE-2022-46169</a>. Based on this <a href="https://pentest-tools.com/vulnerabilities-exploits/cacti-remote-code-execution_CVE-2022-46169" target="_blank" rel="noopener noreffer ">description</a>, <code>RCE</code> vulnerability happens in the <code>remote_agent.php</code> file. It exists due to insufficient authorization when handling <code>HTTP</code> requests with a custom <code>Forwarded-For</code> header.</p>
<p>With quick googling, I managed to find an <a href="https://github.com/FredBrave/CVE-2022-46169-CACTI-1.2.22" target="_blank" rel="noopener noreffer ">exploit</a> about this particular version. Then I&rsquo;m going to execute it, and it&rsquo;s successfully executed.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/exploit-to-foothold.png" title="get the foothold" data-thumbnail="/posts/htb/monitorstwo/exploit-to-foothold.png" data-sub-html="<h2>get the foothold</h2><p>get the foothold</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/exploit-to-foothold.png"
            data-srcset="/posts/htb/monitorstwo/exploit-to-foothold.png, /posts/htb/monitorstwo/exploit-to-foothold.png 1.5x, /posts/htb/monitorstwo/exploit-to-foothold.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/exploit-to-foothold.png" width="1003" height="580" />
    </a><figcaption class="image-caption">get the foothold</figcaption>
    </figure></p>
<p>Like always, I&rsquo;m going to upgrade my reverse shell into full interactive and stabile. However, both of the python version did not exist on this machine. So, I&rsquo;m going to upgrading using <code>script</code>.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/upgrading-tty-using-script.png" title="upgrade tty using script" data-thumbnail="/posts/htb/monitorstwo/upgrading-tty-using-script.png" data-sub-html="<h2>upgrade tty using script</h2><p>upgrade tty using script</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/upgrading-tty-using-script.png"
            data-srcset="/posts/htb/monitorstwo/upgrading-tty-using-script.png, /posts/htb/monitorstwo/upgrading-tty-using-script.png 1.5x, /posts/htb/monitorstwo/upgrading-tty-using-script.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/upgrading-tty-using-script.png" width="640" height="383" />
    </a><figcaption class="image-caption">upgrade tty using script</figcaption>
    </figure></p>
<h3 id="docker-privesc---capsh">Docker: privesc - capsh</h3>
<p>After successfully upgrading my reverse shell. I&rsquo;ll try to check the sudo permission with command <code>sudo -l</code>. Unfortunately, the <code>sudo</code> command did not exist on this machine. So, I&rsquo;ll try to find any <code>SUID</code> binary that can be abused by execute this command <code>find / -perm -u=s 2&gt;/dev/null</code>.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/found-suid-binary-capsh.png" title="found suid capsh" data-thumbnail="/posts/htb/monitorstwo/found-suid-binary-capsh.png" data-sub-html="<h2>found suid capsh</h2><p>found suid capsh</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/found-suid-binary-capsh.png"
            data-srcset="/posts/htb/monitorstwo/found-suid-binary-capsh.png, /posts/htb/monitorstwo/found-suid-binary-capsh.png 1.5x, /posts/htb/monitorstwo/found-suid-binary-capsh.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/found-suid-binary-capsh.png" width="340" height="212" />
    </a><figcaption class="image-caption">found suid capsh</figcaption>
    </figure></p>
<p>Luckly, the <code>capsh</code> was set into <code>SUID</code> binary and it is a tool that provides a handy wrapper for certain types of capability testing and environment creation. Then, I searching up on <a href="https://gtfobins.github.io/" target="_blank" rel="noopener noreffer ">GTFOBins</a> and managed to found this <a href="https://gtfobins.github.io/gtfobins/capsh/#suid" target="_blank" rel="noopener noreffer ">command</a> to abused it. After successful execution, I manage to become a root user.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/get-root-using-capsh.png" title="rooted by capsh" data-thumbnail="/posts/htb/monitorstwo/get-root-using-capsh.png" data-sub-html="<h2>rooted by capsh</h2><p>rooted by capsh</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/get-root-using-capsh.png"
            data-srcset="/posts/htb/monitorstwo/get-root-using-capsh.png, /posts/htb/monitorstwo/get-root-using-capsh.png 1.5x, /posts/htb/monitorstwo/get-root-using-capsh.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/get-root-using-capsh.png" width="577" height="237" />
    </a><figcaption class="image-caption">rooted by capsh</figcaption>
    </figure></p>
<h3 id="docker-entrypointsh">Docker: entrypoint.sh</h3>
<p>Unfortunately, I&rsquo;m in docker container based on the <code>.dockerenv</code> file present. On top of that, my eyes managed to caught something interesting, it was a bash file named <code>entrypoint.sh</code> and it&rsquo;s contains <code>mysql</code> command with plaintext credentials.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/realized-im-in-docker.png" title="rooted in docker" data-thumbnail="/posts/htb/monitorstwo/realized-im-in-docker.png" data-sub-html="<h2>rooted in docker</h2><p>rooted in docker</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/realized-im-in-docker.png"
            data-srcset="/posts/htb/monitorstwo/realized-im-in-docker.png, /posts/htb/monitorstwo/realized-im-in-docker.png 1.5x, /posts/htb/monitorstwo/realized-im-in-docker.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/realized-im-in-docker.png" width="612" height="512" />
    </a><figcaption class="image-caption">rooted in docker</figcaption>
    </figure></p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/read-entrypoint-file.png" title="read entrypoint file" data-thumbnail="/posts/htb/monitorstwo/read-entrypoint-file.png" data-sub-html="<h2>read entrypoint file</h2><p>read entrypoint file</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/read-entrypoint-file.png"
            data-srcset="/posts/htb/monitorstwo/read-entrypoint-file.png, /posts/htb/monitorstwo/read-entrypoint-file.png 1.5x, /posts/htb/monitorstwo/read-entrypoint-file.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/read-entrypoint-file.png" width="1333" height="401" />
    </a><figcaption class="image-caption">read entrypoint file</figcaption>
    </figure></p>
<h3 id="docker-mysql">Docker: mysql</h3>
<p>So, I&rsquo;ll try to log into <code>mysql</code> service with founded credentials above and it&rsquo;s succeed. Then, with quick database enumeration, I found username along side with password hashes.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/all-hashes-from-mysql.png" title="found hashes in mysql" data-thumbnail="/posts/htb/monitorstwo/all-hashes-from-mysql.png" data-sub-html="<h2>found hashes in mysql</h2><p>found hashes in mysql</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/all-hashes-from-mysql.png"
            data-srcset="/posts/htb/monitorstwo/all-hashes-from-mysql.png, /posts/htb/monitorstwo/all-hashes-from-mysql.png 1.5x, /posts/htb/monitorstwo/all-hashes-from-mysql.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/all-hashes-from-mysql.png" width="830" height="218" />
    </a><figcaption class="image-caption">found hashes in mysql</figcaption>
    </figure></p>
<p>Since I already have the hashes of the user. I&rsquo;m going to crack it with <a href="https://github.com/openwall/john" target="_blank" rel="noopener noreffer ">john</a>. Unfortunately, the <code>admin</code> hash did not cracked successfully. However, it managed to crack the other hash, which is <code>marcus</code>.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/john-cracked-marcus.png" title="john cracked hashes" data-thumbnail="/posts/htb/monitorstwo/john-cracked-marcus.png" data-sub-html="<h2>john cracked hashes</h2><p>john cracked hashes</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/john-cracked-marcus.png"
            data-srcset="/posts/htb/monitorstwo/john-cracked-marcus.png, /posts/htb/monitorstwo/john-cracked-marcus.png 1.5x, /posts/htb/monitorstwo/john-cracked-marcus.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/john-cracked-marcus.png" width="954" height="282" />
    </a><figcaption class="image-caption">john cracked hashes</figcaption>
    </figure></p>
<h2 id="ssh-marcus">SSH: marcus</h2>
<p>I successfully log into the machine via cracked credentials of the user called <code>marcus</code> through <code>SSH</code>.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/ssh-in-marcus.png" title="ssh as marcus" data-thumbnail="/posts/htb/monitorstwo/ssh-in-marcus.png" data-sub-html="<h2>ssh as marcus</h2><p>ssh as marcus</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/ssh-in-marcus.png"
            data-srcset="/posts/htb/monitorstwo/ssh-in-marcus.png, /posts/htb/monitorstwo/ssh-in-marcus.png 1.5x, /posts/htb/monitorstwo/ssh-in-marcus.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/ssh-in-marcus.png" width="1188" height="843" />
    </a><figcaption class="image-caption">ssh as marcus</figcaption>
    </figure></p>
<p>I&rsquo;m in as a <code>marcus</code> user. Like always, I&rsquo;m going to check the sudo permission of this user with the command <code>sudo -l</code>. Turns out, this user cannot run as <code>sudo</code> on this machine.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/check-the-sudo-permission.png" title="check sudo permission" data-thumbnail="/posts/htb/monitorstwo/check-the-sudo-permission.png" data-sub-html="<h2>check sudo permission</h2><p>check sudo permission</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/check-the-sudo-permission.png"
            data-srcset="/posts/htb/monitorstwo/check-the-sudo-permission.png, /posts/htb/monitorstwo/check-the-sudo-permission.png 1.5x, /posts/htb/monitorstwo/check-the-sudo-permission.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/check-the-sudo-permission.png" width="519" height="138" />
    </a><figcaption class="image-caption">check sudo permission</figcaption>
    </figure></p>
<h3 id="ssh-docker-version">SSH: docker version</h3>
<p>I really dumbfounded. Then, I&rsquo;m thinking, if this machine has a docker inside it. It might worth checking the installed docker version with a simple command <code>docker --version</code>.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/check-docker-version.png" title="check docker version" data-thumbnail="/posts/htb/monitorstwo/check-docker-version.png" data-sub-html="<h2>check docker version</h2><p>check docker version</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/check-docker-version.png"
            data-srcset="/posts/htb/monitorstwo/check-docker-version.png, /posts/htb/monitorstwo/check-docker-version.png 1.5x, /posts/htb/monitorstwo/check-docker-version.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/check-docker-version.png" width="463" height="99" />
    </a><figcaption class="image-caption">check docker version</figcaption>
    </figure></p>
<h2 id="privesc-cve-2021-41091">PrivEsc: CVE-2021-41091</h2>
<p>Based on the version above. It seems this an old docker engine dated back to <code>2021</code>. Then, I found this <a href="https://github.com/UncleJ4ck/CVE-2021-41091/tree/main" target="_blank" rel="noopener noreffer ">exploit</a> on the internet and it gets assign <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41091" target="_blank" rel="noopener noreffer ">CVE-2021-41091</a>. Based on this <a href="https://github.com/UncleJ4ck/CVE-2021-41091/tree/main#vulnerability-summary" target="_blank" rel="noopener noreffer ">description</a>, it&rsquo;s allow unprivileged users to traverse and execute programs within the data directory (typically <code>/var/lib/docker</code>) due to improperly restricted permissions.</p>
<p>To exploit it successfully, first, I need to go back to <a href="https://shafiqaiman.com/posts/htb/monitorstwo/#docker-privesc---capsh" target="_blank" rel="noopener noreffer ">shell</a> that I have in docker container and setup <code>/bin/bash</code> as a <code>SUID</code> binary.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/setup-bin-bash-in-docker.png" title="setup bash as suid" data-thumbnail="/posts/htb/monitorstwo/setup-bin-bash-in-docker.png" data-sub-html="<h2>setup bash as suid</h2><p>setup bash as suid</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/setup-bin-bash-in-docker.png"
            data-srcset="/posts/htb/monitorstwo/setup-bin-bash-in-docker.png, /posts/htb/monitorstwo/setup-bin-bash-in-docker.png 1.5x, /posts/htb/monitorstwo/setup-bin-bash-in-docker.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/setup-bin-bash-in-docker.png" width="603" height="236" />
    </a><figcaption class="image-caption">setup bash as suid</figcaption>
    </figure></p>
<p>Then, I transfer this <a href="https://github.com/UncleJ4ck/CVE-2021-41091" target="_blank" rel="noopener noreffer ">exploit</a> into the machine that I have <code>SSH</code> into, and make it executable with command <code>chmod +x</code>. When everything already setup, finally, I can execute the exploit and it was successeded. Lastly, I&rsquo;m going to change directory into vulnerable path and execute this command <code>./bin/bash -p</code> and become root.</p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/transfer-the-exploit-into-victim.png" title="transfer exploit into victim" data-thumbnail="/posts/htb/monitorstwo/transfer-the-exploit-into-victim.png" data-sub-html="<h2>transfer exploit into victim</h2><p>transfer exploit into victim</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/transfer-the-exploit-into-victim.png"
            data-srcset="/posts/htb/monitorstwo/transfer-the-exploit-into-victim.png, /posts/htb/monitorstwo/transfer-the-exploit-into-victim.png 1.5x, /posts/htb/monitorstwo/transfer-the-exploit-into-victim.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/transfer-the-exploit-into-victim.png" width="799" height="491" />
    </a><figcaption class="image-caption">transfer exploit into victim</figcaption>
    </figure></p>
<p><figure><a class="lightgallery" href="/posts/htb/monitorstwo/become-root.png" title="become true root" data-thumbnail="/posts/htb/monitorstwo/become-root.png" data-sub-html="<h2>become true root</h2><p>become true root</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/htb/monitorstwo/become-root.png"
            data-srcset="/posts/htb/monitorstwo/become-root.png, /posts/htb/monitorstwo/become-root.png 1.5x, /posts/htb/monitorstwo/become-root.png 2x"
            data-sizes="auto"
            alt="/posts/htb/monitorstwo/become-root.png" width="1361" height="637" />
    </a><figcaption class="image-caption">become true root</figcaption>
    </figure></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 03-09-2023</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://shafiqaiman.com/posts/htb/monitorstwo/" data-title="HackTheBox - MonitorsTwo Writeup" data-via="_shafiqaiman_" data-hashtags="CVE-2022-46169,CVE-2021-41091,upgrade-shell-using-script,rce,GTFOBins,capsh,mysql,john,docker"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://shafiqaiman.com/posts/htb/monitorstwo/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://shafiqaiman.com/posts/htb/monitorstwo/" data-title="HackTheBox - MonitorsTwo Writeup"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://shafiqaiman.com/posts/htb/monitorstwo/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/cve-2022-46169/">CVE-2022-46169</a>,&nbsp;<a href="/tags/cve-2021-41091/">CVE-2021-41091</a>,&nbsp;<a href="/tags/upgrade-shell-using-script/">upgrade-shell-using-script</a>,&nbsp;<a href="/tags/rce/">rce</a>,&nbsp;<a href="/tags/gtfobins/">GTFOBins</a>,&nbsp;<a href="/tags/capsh/">capsh</a>,&nbsp;<a href="/tags/mysql/">mysql</a>,&nbsp;<a href="/tags/john/">john</a>,&nbsp;<a href="/tags/docker/">docker</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/htb/busqueda/" class="prev" rel="prev" title="HackTheBox - Busqueda Writeup"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>HackTheBox - Busqueda Writeup</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2021 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://shafiqaiman.com" target="_blank">SHAFIQAIMAN</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
